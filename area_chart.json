{
	"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
	"description": "Interactive line chart for Malaysian mean and median household income (1970â€“2022) with pandemic annotation.",
	"autosize": {
		"type": "fit",
		"contains": "padding"
	},
	"width": "container",
	"height": 600,
	"width": 850,
	"padding": {
		"left": 60,
		"right": 60,
		"top": 80,
		"bottom": 60
	},
	"data": {
		"url": "hh_income_state (2).csv"
	},
	"params": [ 
		{
			"name": "selected_state", 
			"value": "Johor",
			"bind": {
				"input": "select",
				"options": [
					"Johor",
					"Kedah",
					"Kelantan",
					"Melaka",
					"NegeriSembilan",
					"Pahang",
					"Perak",
					"Perlis",
					"PulauPinang",
					"Sabah",
					"Sarawak",
					"Selangor",
					"Trengganu",
					"KualaLumpur",
					"Labuan",
					"Putrajaya"
				],
				"labels": [
					"Johor",
					"Kedah",
					"Kelantan",
					"Melaka",
					"NegeriSembilan",
					"Pahang",
					"Perak",
					"Perlis",
					"PulauPinang",
					"Sabah",
					"Sarawak",
					"Selangor",
					"Trengganu",
					"KualaLumpur",
					"Labuan",
					"Putrajaya"
				],
				"name": "Select State: "
			}
		},
		{
			"name": "start_year",
			"value": 1970,
			"bind": {
				"input": "range",
				"min": 1970,
				"max": 2019,
				"step": 1,
				"name": "Start Year: "
			}
		},
		{
			"name": "end_year",
			"value": 2022,
			"bind": {
				"input": "range",
				"min": 1974,
				"max": 2022,
				"step": 1,
				"name": "End Year: "
			}
		}
	],
	"transform": [
		{
			"filter": "datum.state == selected_state"
		},
		{
			"filter": "year(datum.date) >= start_year && year(datum.date) <= end_year"
		},
		{
			"fold": [
				"income_mean",
				"income_median"
			],
			"as": [
				"Income Type",
				"Income Value"
			]
		},
		{
			"calculate": "datum['Income Type'] == 'income_mean' ? 'Mean Income' : 'Median Income'",
			"as": "Income Label"
		}
	],
	"layer": [
		{
			"mark": {
				"type": "line",
				"point": true,
				"strokeWidth": 2
			},
			"encoding": {
				"x": {
					"field": "date",
					"type": "temporal",
					"timeUnit": "year",
					"title": "Year",
					"axis": {
						"grid": false
					}
				},
				"y": {
					"field": "Income Value",
					"type": "quantitative",
					"title": "Household Income (RM)",
					"scale": {
						"domain": [
							0,
							14000
						]
					},
					"axis": {
						"grid": false
					}
				},
				"color": {
					"field": "Income Label",
					"type": "nominal",
					"scale": {
						"domain": [
							"Mean Income",
							"Median Income"
						],
						"range": [
							"#F58518",
							"#4C78A8"
						]
					},
					"title": "Income Type"
				},
				"tooltip": [
					{
						"field": "date",
						"type": "temporal",
						"timeUnit": "year",
						"title": "Year"
					},
					{
						"field": "Income Label",
						"type": "nominal",
						"title": "Type"
					},
					{
						"field": "Income Value",
						"type": "quantitative",
						"title": "Income (RM)"
					}
				]
			}
		},
		{
			"transform": [
				{
					"filter": "1997 >= start_year && 1997 <= end_year"
				},
				{
					"filter": "year(datum.date) == 1997"
				}
			],
			"layer": [
				{
					"mark": {
						"type": "rule",
						"color": "red",
						"strokeDash": [
							4,
							4
						],
						"strokeWidth": 1.5
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						}
					}
				},
				{
					"mark": {
						"type": "text",
						"align": "center",
						"dx": 45,
						"dy": -40,
						"color": "red",
						"fontSize": 13,
						"fontWeight": "bold"
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						},
						"y": {
							"field": "Income Value",
							"type": "quantitative",
							"aggregate": "mean"
						},
						"text": {
							"value": "1997: Asian Financial Crisis"
						}
					}
				}
			]
		},
		{
			"transform": [
				{
					"filter": "2012 >= start_year && 2012 <= end_year"
				},
				{
					"filter": "year(datum.date) == 2012"
				}
			],
			"layer": [
				{
					"mark": {
						"type": "rule",
						"color": "red",
						"strokeDash": [
							4,
							4
						],
						"strokeWidth": 1.5
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						}
					}
				},
				{
					"mark": {
						"type": "text",
						"align": "center",
						"dx": -20,
						"dy": -120,
						"color": "red",
						"fontSize": 13,
						"fontWeight": "bold"
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						},
						"y": {
							"field": "Income Value",
							"type": "quantitative",
							"aggregate": "mean"
						},
						"text": {
							"value": "2012: Minimum Wage Policy Changes"
						}
					}
				}
			]
		},
		{
			"transform": [
				{
					"filter": "2020 >= start_year && 2020 <= end_year"
				},
				{
					"filter": "year(datum.date) == 2020"
				}
			],
			"layer": [
				{
					"mark": {
						"type": "rule",
						"color": "red",
						"strokeDash": [
							4,
							4
						],
						"strokeWidth": 1.5
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						}
					}
				},
				{
					"mark": {
						"type": "text",
						"align": "center",
						"dx": -15,
						"dy": -110,
						"color": "red",
						"fontSize": 13,
						"fontWeight": "bold"
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						},
						"y": {
							"field": "Income Value",
							"type": "quantitative",
							"aggregate": "mean"
						},
						"text": {
							"value": "2020: COVID-19"
						}
					}
				}
			]
		}
	]
}