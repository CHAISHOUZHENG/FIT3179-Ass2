{
	"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
	"description": "Interactive area chart for Malaysian median household income (1970â€“2022) with centered pandemic annotation.",
	"autosize": {
		"type": "fit",
		"contains": "padding"
	},
	"width": "container",
	"height": 500,
	"padding": {
		"left": 60,
		"right": 60,
		"top": 20,
		"bottom": 60
	},
	"data": {
		"url": "hh_income_state (2).csv"
	},
	"params": [
		{
			"name": "selected_state",
			"value": "Johor",
			"bind": {
				"input": "select",
				"options": [
					"Johor",
					"Kedah",
					"Kelantan",
					"Melaka",
					"NegeriSembilan",
					"Pahang",
					"Perak",
					"Perlis",
					"PulauPinang",
					"Sabah",
					"Sarawak",
					"Selangor",
					"Trengganu",
					"KualaLumpur",
					"Labuan",
					"Putrajaya"
				],
				"labels": [
					"Johor",
					"Kedah",
					"Kelantan",
					"Melaka",
					"NegeriSembilan",
					"Pahang",
					"Perak",
					"Perlis",
					"PulauPinang",
					"Sabah",
					"Sarawak",
					"Selangor",
					"Trengganu",
					"KualaLumpur",
					"Labuan",
					"Putrajaya"
				],
				"name": "Select State: "
			}
		},
		{
			"name": "start_year",
			"value": 1970,
			"bind": {
				"input": "range",
				"min": 1970,
				"max": 2019,
				"step": 1,
				"name": "Start Year: "
			}
		},
		{
			"name": "end_year",
			"value": 2022,
			"bind": {
				"input": "range",
				"min": 1974,
				"max": 2022,
				"step": 1,
				"name": "End Year: "
			}
		}
	],
	"transform": [
		{
			"filter": "datum.state == selected_state"
		},
		{
			"filter": "year(datum.date) >= start_year && year(datum.date) <= end_year"
		}
	],
	"layer": [
		{
			"mark": {
				"type": "area",
				"line": true,
				"point": true,
				"color": "#4C78A8",
				"opacity": 0.4
			},
			"encoding": {
				"x": {
					"field": "date",
					"type": "temporal",
					"timeUnit": "year",
					"title": "Year"
				},
				"y": {
					"field": "income_median",
					"type": "quantitative",
					"title": "Median Household Income (RM)",
					"scale": {
						"domain": [
							0,
							12000
						]
					}
				},
				"tooltip": [
					{
						"field": "date",
						"type": "temporal",
						"timeUnit": "year",
						"title": "Year"
					},
					{
						"field": "income_median",
						"type": "quantitative",
						"title": "Median Income (RM)"
					}
				]
			}
		},
		{
			"transform": [
				{
					"filter": "2020 >= start_year && 2020 <= end_year"
				},
				{
					"filter": "year(datum.date) == 2020"
				}
			],
			"layer": [
				{
					"mark": {
						"type": "rule",
						"color": "red",
						"strokeDash": [
							4,
							4
						],
						"strokeWidth": 1.5
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						}
					}
				},
				{
					"mark": {
						"type": "text",
						"align": "center",
						"dx": 45,
						"dy": 10,
						"color": "red",
						"fontSize": 13,
						"fontWeight": "bold"
					},
					"encoding": {
						"x": {
							"field": "date",
							"type": "temporal",
							"timeUnit": "year"
						},
						"y": {
							"field": "income_median",
							"type": "quantitative",
							"aggregate": "mean"
						},
						"text": {
							"value": "2020: Sharp decline due to pandemic, recovery by 2022."
						}
					}
				}
			]
		}
	]
}